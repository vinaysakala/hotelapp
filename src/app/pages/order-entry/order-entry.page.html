<ion-header class="ion-no-border">
  <ion-toolbar class="header-toolbar">
    <ion-buttons slot="start">
      <ion-back-button defaultHref="/tabs/tab1"></ion-back-button>
    </ion-buttons>
    <ion-title>Table: <b>{{ tableName }}</b></ion-title>
  </ion-toolbar>
</ion-header>

<ion-content style="--background: #ffffff;">
  <ion-toolbar color="white">
    <ion-searchbar placeholder="Search food..." class="custom-searchbar" (ionInput)="onSearch($event)"></ion-searchbar>
  </ion-toolbar>

  <div class="category-scroll">
    <ion-chip [outline]="selectedCat !== 'all'" color="primary" (click)="filterByCategory('all')">All</ion-chip>
    <ion-chip *ngFor="let cat of categories" [outline]="selectedCat !== cat.id" color="primary"
      (click)="filterByCategory(cat.id)">
      {{ cat.name }}
    </ion-chip>
  </div>

  <div class="card-container">
    <ion-card mode="ios" *ngFor="let item of filteredItems" class="order-item-card">
      <ion-item lines="none">
        <div slot="start" class="type-indicator" [ngClass]="item.type === 'Veg' ? 'veg' : 'non-veg'">
          <div class="dot"></div>
        </div>

        <ion-label>
          <h2 class="item-name">{{ item.name }}</h2>
          <h3 class="price-text">₹{{ item.price }}</h3>
        </ion-label>

        <div slot="end" class="quantity-controls">
          <ion-button fill="clear" color="medium" (click)="removeFromCart(item)" *ngIf="getQuantity(item.id) > 0">
            <ion-icon name="remove-circle-outline"></ion-icon>
          </ion-button>
          <span class="qty-label" *ngIf="getQuantity(item.id) > 0">{{ getQuantity(item.id) }}</span>
          <ion-button fill="clear" color="primary" (click)="addToCart(item)">
            <ion-icon name="add-circle"></ion-icon>
          </ion-button>
        </div>
      </ion-item>
    </ion-card>
  </div>
</ion-content>

<ion-footer *ngIf="cart.length > 0">
  <ion-toolbar color="primary" (click)="viewCartModal()">
    <ion-label slot="start" class="ion-padding-start">
      <b>{{ cart.length }} Items is selected</b>
    </ion-label>
    <!-- <ion-buttons slot="end">
      <ion-button>VIEW CART <ion-icon name="cart" class="m-2"></ion-icon></ion-button>
    </ion-buttons> -->
    <ion-buttons slot="end">
  <ion-button fill="clear" class="view-cart-btn">
    <ion-icon 
      slot="start" 
      name="cart" 
      [class.animate-bounce]="cartAnimation">
    </ion-icon>
    VIEW CART
  </ion-button>
</ion-buttons>
  </ion-toolbar>
</ion-footer>


<ion-modal [isOpen]="isCartModalOpen" (ionModalDidDismiss)="isCartModalOpen = false" [breakpoints]="[0, 0.5, 0.8]"
  [initialBreakpoint]="0.8">
  <ng-template>
    <ion-header class="ion-no-border">
      <ion-toolbar>
        <ion-title>Review Order</ion-title>
        <ion-buttons slot="end">
          <ion-button (click)="isCartModalOpen = false">Close</ion-button>
        </ion-buttons>
      </ion-toolbar>
    </ion-header>

    <ion-content class="ion-padding">
      <ion-list lines="full">
        <ion-item *ngFor="let item of cart">
          <ion-label>
            <h2>{{ item.name }}</h2>
            <p>₹{{ item.price }} x {{ item.qty }}</p>
          </ion-label>
          <ion-text slot="end"><b>₹{{ item.price * item.qty }}</b></ion-text>
        </ion-item>
      </ion-list>

      <div class="total-section ion-padding-top">
        <ion-item lines="none">
          <ion-label>Subtotal</ion-label>
          <ion-note slot="end">₹{{ cartTotal }}</ion-note>
        </ion-item>
        <ion-item lines="none">
          <ion-label>
            <h1><b>Grand Total</b></h1>
          </ion-label>
          <ion-note slot="end">
            <h1><b>₹{{ cartTotal }}</b></h1>
          </ion-note>
        </ion-item>
      </div>

      <ion-button expand="block" shape="round" color="success" class="ion-margin-top confirm-btn"
        (click)="placeOrder()">
        SEND TO KITCHEN (KOT)
      </ion-button>
    </ion-content>
  </ng-template>
</ion-modal>